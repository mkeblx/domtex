<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>imagemap test</title>
<style>
#container {
  border: 2px solid black;
  padding: 5px;
  min-width: 10px;
  min-height: 10px;
  display: inline-block;
}
</style>
</head>
<body>
  <h1>Image map test</h1>

  <div id="container">
    <img id="img" src="" usemap="#links-map" />

    <map name="links-map" id="linksmap">
    </map>
  </div>

<script>
'use strict';

var container = document.getElementById('container');
var img = document.getElementById('img');
var map = document.getElementById('linksmap');

var file = 'data/hn-imagemap.json';
fetch(file)
  .then((resp) => resp.json())
  .then(process);

function process(resp) {

  console.log(resp);

  var w = resp.width;
  var h = resp.height;
  var path = resp.path;
  var url = resp.url;
  var links = resp.links;

  img.setAttribute('width', w);
  img.setAttribute('height', h);
  img.setAttribute('src', '/'+path);

  for (var i = 0; i < links.length; i++) {
    var l = links[i];
    var href = l.href;
    if (!href.startsWith('http') && !href.startsWith('mailto'))
      href = url + '/' + href; // TODO: don't always want to add slash unless bare domain
    //console.log(href);

    if (l.x > w || l.y > h)
      continue;

    var coords = [l.x, l.y, Math.min(l.x+l.width, w), Math.min(l.y+l.height, h)];

    var areaEl = document.createElement('area');
    console.log(areaEl);
    areaEl.setAttribute('shape', 'rect');
    areaEl.setAttribute('coords', coords.join(','));
    areaEl.setAttribute('href', href);
    map.appendChild(areaEl);
  }

}
</script>
</body>
</html>